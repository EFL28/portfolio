---
import NextjsIcon from "simple-icons-astro/Nextdotjs";
import NestjsIcon from "simple-icons-astro/Nestjs";
import TailwindcssIcon from "simple-icons-astro/Tailwindcss";
import TypescriptIcon from "simple-icons-astro/Typescript";
import RedisIcon from "simple-icons-astro/Redis";
import PostgresqlIcon from "simple-icons-astro/Postgresql";
import PrismaIcon from "simple-icons-astro/Prisma";
import SupabaseIcon from "simple-icons-astro/Supabase";
import { getLangFromUrl, useTranslations } from "../i18n/utils";
import ProjectCard from "./ProjectCard.astro";
import CarouselButton from "./CarouselButton.astro";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const PROJECTS = [
  {
    title: "Sindic Memes",
    description:
      "Web para guardar memes (fotos, videos, gifs, posts de redes sociales) y compartirlos f√°cilmente con tus amigos.",
    url: "https://sindic-memes.vercel.app/",
    github: "https://github.com/EFL28/sindic-memes",
    image: "/projects/SindicMemes_preview.jpg",
    tech_stack: [
      { name: "Typescript", icon: TypescriptIcon },
      { name: "NextJs", icon: NextjsIcon },
      { name: "Tailwind", icon: TailwindcssIcon },
      { name: "Supabase", icon: SupabaseIcon },
    ],
    status: "in_progress",
  },
  {
    title: "QuiniSindic Frontend",
    description:
      "Plataforma de resultados y predicciones deportivas con amigos.",
    url: "https://sindic.xyz/",
    github: "https://github.com/QuiniSindic/QuinisindicFrontend",
    image: "/projects/QuinisindicFrontend_preview.jpg",
    tech_stack: [
      { name: "Typescript", icon: TypescriptIcon },
      { name: "NextJs", icon: NextjsIcon },
      { name: "Tailwind", icon: TailwindcssIcon },
    ],
    status: "in_progress",
  },
  {
    title: "QuiniSindic Backend",
    description: "API REST para QuiniSindic.",
    url: "https://api.sindic.xyz/",
    github: "https://github.com/QuiniSindic/QuinisindicBackend",
    image: "/projects/QuinisindicBackend_preview.jpg",
    tech_stack: [
      { name: "Typescript", icon: TypescriptIcon },
      { name: "Nestjs", icon: NestjsIcon },
      { name: "PostgreSQL", icon: PostgresqlIcon },
      { name: "Prisma", icon: PrismaIcon },
      { name: "Redis", icon: RedisIcon },
    ],
    status: "in_progress",
  },
];
---

<section id="projects" class="flex flex-col gap-y-10 px-4">
  <div class="flex items-center justify-between">
    <h2 class="text-3xl font-bold">
      {t("projects")}
    </h2>

    <div class="hidden md:flex gap-x-2">
      <CarouselButton id="prevBtn" direction="left" variant="desktop" />
      <CarouselButton id="nextBtn" direction="right" variant="desktop" />
    </div>
  </div>

  <div
    id="project-container"
    class="flex gap-x-6 overflow-x-auto snap-x snap-mandatory scrollbar-hide pb-2 -mx-4 px-4 md:mx-0 md:px-0"
  >
    {
      PROJECTS.map(
        ({
          title,
          image,
          description,
          tech_stack,
          url,
          github,
          status: project_status,
        }) => (
          <ProjectCard
            title={title}
            image={image}
            description={description}
            tech_stack={tech_stack}
            url={url}
            github={github}
            lang={lang}
            status={project_status as "finished" | "in_progress"}
          />
        )
      )
    }
  </div>

  <div class="flex md:hidden justify-center gap-x-6 mt-2">
    <CarouselButton id="prevBtnMobile" direction="left" variant="mobile" />
    <CarouselButton id="nextBtnMobile" direction="right" variant="mobile" />
  </div>
</section>

<style>
  /* hide scrollbar */
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>

<script>
  function initCarousel() {
    const container = document.getElementById("project-container");
    const nextBtns = [
      document.getElementById("nextBtn"),
      document.getElementById("nextBtnMobile"),
    ];
    const prevBtns = [
      document.getElementById("prevBtn"),
      document.getElementById("prevBtnMobile"),
    ];

    if (!container) return;

    const scrollAmount = () => container.offsetWidth * 0.8;

    // handlers
    const handleNext = () => {
      container.scrollBy({ left: scrollAmount(), behavior: "smooth" });
    };

    const handlePrev = () => {
      container.scrollBy({ left: -scrollAmount(), behavior: "smooth" });
    };

    // remove listeners and new ones
    nextBtns.forEach((btn) => {
      btn?.removeEventListener("click", handleNext);
      btn?.addEventListener("click", handleNext);
    });

    prevBtns.forEach((btn) => {
      btn?.removeEventListener("click", handlePrev);
      btn?.addEventListener("click", handlePrev);
    });
  }

  initCarousel();
</script>
