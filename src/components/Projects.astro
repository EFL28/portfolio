---
import ReactIcon from "simple-icons-astro/React";
import TailwindcssIcon from "simple-icons-astro/Tailwindcss";
import AstroIcon from "simple-icons-astro/Astro";
import { getLangFromUrl, useTranslations } from "../i18n/utils";
import ProjectCard from "./ProjectCard.astro";
import CarouselButton from "./CarouselButton.astro";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const PROJECTS = [
  {
    title: "Project Name 1",
    description:
      "Una breve descripción de lo que hace el proyecto y el problema que resuelve.",
    url: "#",
    github: "#",
    image: "/projects/project1.webp",
    tech_stack: [
      { name: "React", icon: ReactIcon },
      { name: "Astro", icon: AstroIcon },
      { name: "Tailwind", icon: TailwindcssIcon },
    ],
  },
  {
    title: "Project Name 2",
    description:
      "Una breve descripción de lo que hace el proyecto y el problema que resuelve.",
    url: "#",
    github: "#",
    image: "/projects/project2.webp",
    tech_stack: [
      { name: "React", icon: ReactIcon },
      { name: "Astro", icon: AstroIcon },
      { name: "Tailwind", icon: TailwindcssIcon },
    ],
  },
  {
    title: "Project Name 3",
    description:
      "Una breve descripción de lo que hace el proyecto y el problema que resuelve.",
    url: "#",
    github: "#",
    image: "/projects/project3.webp",
    tech_stack: [
      { name: "React", icon: ReactIcon },
      { name: "Astro", icon: AstroIcon },
      { name: "Tailwind", icon: TailwindcssIcon },
    ],
  },
  {
    title: "Project Name 4",
    description:
      "Una breve descripción de lo que hace el proyecto y el problema que resuelve.",
    url: "#",
    github: "#",
    image: "/projects/project4.webp",
    tech_stack: [
      { name: "React", icon: ReactIcon },
      { name: "Astro", icon: AstroIcon },
      { name: "Tailwind", icon: TailwindcssIcon },
    ],
  },
  {
    title: "Project Name 5",
    description:
      "Una breve descripción de lo que hace el proyecto y el problema que resuelve.",
    url: "#",
    github: "#",
    image: "/projects/project5.webp",
    tech_stack: [
      { name: "React", icon: ReactIcon },
      { name: "Astro", icon: AstroIcon },
      { name: "Tailwind", icon: TailwindcssIcon },
    ],
  },
];
---

<section id="projects" class="flex flex-col gap-y-10 px-4">
  <div class="flex items-center justify-between">
    <h2 class="text-3xl font-bold">
      {t("projects")}
    </h2>

    <div class="hidden md:flex gap-x-2">
      <CarouselButton id="prevBtn" direction="left" variant="desktop" />
      <CarouselButton id="nextBtn" direction="right" variant="desktop" />
    </div>
  </div>

  <div
    id="project-container"
    class="flex gap-x-6 overflow-x-auto snap-x snap-mandatory scrollbar-hide pb-2 -mx-4 px-4 md:mx-0 md:px-0"
  >
    {
      PROJECTS.map(({ title, image, description, tech_stack, url, github }) => (
        <ProjectCard
          title={title}
          image={image}
          description={description}
          tech_stack={tech_stack}
          url={url}
          github={github}
          lang={lang}
        />
      ))
    }
  </div>

  <div class="flex md:hidden justify-center gap-x-6 mt-2">
    <CarouselButton id="prevBtnMobile" direction="left" variant="mobile" />
    <CarouselButton id="nextBtnMobile" direction="right" variant="mobile" />
  </div>
</section>

<style>
  /* hide scrollbar */
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>

<script>
  function initCarousel() {
    const container = document.getElementById("project-container");
    const nextBtns = [
      document.getElementById("nextBtn"),
      document.getElementById("nextBtnMobile"),
    ];
    const prevBtns = [
      document.getElementById("prevBtn"),
      document.getElementById("prevBtnMobile"),
    ];

    if (!container) return;

    const scrollAmount = () => container.offsetWidth * 0.8;

    // handlers
    const handleNext = () => {
      container.scrollBy({ left: scrollAmount(), behavior: "smooth" });
    };

    const handlePrev = () => {
      container.scrollBy({ left: -scrollAmount(), behavior: "smooth" });
    };

    // remove listeners and new ones
    nextBtns.forEach((btn) => {
      btn?.removeEventListener("click", handleNext);
      btn?.addEventListener("click", handleNext);
    });

    prevBtns.forEach((btn) => {
      btn?.removeEventListener("click", handlePrev);
      btn?.addEventListener("click", handlePrev);
    });
  }

  initCarousel();
</script>
